from flask import Flask, render_template, request, jsonify, send_file
from flask_cors import CORS
from datetime import datetime
import os
import json
import base64
import io
import numpy as np
from PIL import Image
import openai
import reportlab
from reportlab.lib.pagesizes import letter
from reportlab.pdfgen import canvas
from reportlab.lib.utils import ImageReader
from reportlab.pdfbase import pdfmetrics
from reportlab.pdfbase.ttfonts import TTFont
import tempfile
import traceback
import keras

app = Flask(__name__)
CORS(app)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏
app.config['SECRET_KEY'] = 'health-ai-scanner-secret-key-2024'
app.config['MAX_CONTENT_LENGTH'] = 16 * 1024 * 1024

# ‚ö†Ô∏è –í–ê–® OPENAI API –ö–õ–Æ–ß
OPENAI_API_KEY = "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"
openai.api_key = OPENAI_API_KEY

# –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—É—á–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
print("=" * 50)
print("–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—É—á–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π...")

def load_model_safe(model_path):
    """–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ –≤–µ—Ä—Å–∏–π"""
    try:
        # –ü–æ–ø—ã—Ç–∫–∞ 1: –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–µ–∑ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
        print(f"  –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å: {model_path}")
        model = keras.models.load_model(model_path, compile=False)
        print(f"  ‚úì –£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
        return model
    except Exception as e:
        # –ü–æ–ø—ã—Ç–∫–∞ 2: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å safe_mode
        try:
            print(f"  –ü–æ–ø—ã—Ç–∫–∞ —Å –æ–ø—Ü–∏—è–º–∏...")
            import tensorflow as tf
            model = tf.keras.models.load_model(model_path, compile=False)
            return model
        except:
            print(f"  ‚úó –û—à–∏–±–∫–∞: {str(e)[:80]}")
            return None

acne_model = load_model_safe('models/acne_model.h5')
eyes_model = load_model_safe('models/eyes_model.h5')
nails_model = load_model_safe('models/nails_model.h5')
xray_model = load_model_safe('models/xray_model.h5')

loaded_count = sum([1 for m in [acne_model, eyes_model, nails_model, xray_model] if m is not None])
if loaded_count == 4:
    print("‚úÖ –í—Å–µ –º–æ–¥–µ–ª–∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!")
elif loaded_count > 0:
    print(f"‚ö†Ô∏è –ó–∞–≥—Ä—É–∂–µ–Ω–æ {loaded_count} –∏–∑ 4 –º–æ–¥–µ–ª–µ–π")
else:
    print("‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π")
    print("–ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-—Ä–µ–∂–∏–º")

print("=" * 50)

# –ö–ª–∞—Å—Å—ã –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏
DISEASE_CLASSES = {
    'skin': ['–ê–∫–Ω–µ', '–≠–∫–∑–µ–º–∞', '–ü—Å–æ—Ä–∏–∞–∑', '–ö—Ä–∞–ø–∏–≤–Ω–∏—Ü–∞', '–†–æ–∑–∞—Ü–µ–∞', '–î–µ—Ä–º–∞—Ç–∏—Ç', '–í–∏—Ç–∏–ª–∏–≥–æ', '–ú–µ–ª–∞–Ω–æ–º–∞', '–ë–∞–∑–∞–ª–∏–æ–º–∞', '–ì–µ—Ä–ø–µ—Å', '–ù–æ—Ä–º–∞'],
    'eyes': ['–ö–æ–Ω—ä—é–Ω–∫—Ç–∏–≤–∏—Ç', '–ö–∞—Ç–∞—Ä–∞–∫—Ç–∞', '–Ø—á–º–µ–Ω—å', '–ì–ª–∞—É–∫–æ–º–∞', '–ë–ª–µ—Ñ–∞—Ä–∏—Ç', '–•–∞–ª—è–∑–∏–æ–Ω', '–ö–µ—Ä–∞—Ç–∏—Ç', '–ù–æ—Ä–º–∞'],
    'nails': ['–ì—Ä–∏–±–æ–∫ –Ω–æ–≥—Ç–µ–π', '–¢—Ä–∞–≤–º–∞ –Ω–æ–≥—Ç—è', '–ü—Å–æ—Ä–∏–∞–∑ –Ω–æ–≥—Ç–µ–π', '–û–Ω–∏—Ö–æ–ª–∏–∑–∏—Å', '–ü–∞–Ω–∞—Ä–∏—Ü–∏–π', '–ù–æ—Ä–º–∞'],
    'xray': ['–ü–Ω–µ–≤–º–æ–Ω–∏—è', '–¢—É–±–µ—Ä–∫—É–ª–µ–∑', '–ü–µ—Ä–µ–ª–æ–º', '–ü–Ω–µ–≤–º–æ—Ç–æ—Ä–∞–∫—Å', '–ü–ª–µ–≤—Ä–∏—Ç', '–ù–æ—Ä–º–∞']
}

# –ë–∞–∑–∞ –±–æ–ª—å–Ω–∏—Ü –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞
HOSPITALS_KAZAKHSTAN = [
    {
        "name": "–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –Ω–∞—É—á–Ω—ã–π —Ü–µ–Ω—Ç—Ä –º–∞—Ç–µ—Ä–∏–Ω—Å—Ç–≤–∞ –∏ –¥–µ—Ç—Å—Ç–≤–∞",
        "city": "–ê—Å—Ç–∞–Ω–∞",
        "address": "—É–ª. –¢—É—Ä–∞–Ω, 32",
        "phone": "+7 (7172) 70-76-76",
        "specialties": ["–ü–µ–¥–∏–∞—Ç—Ä–∏—è", "–ì–∏–Ω–µ–∫–æ–ª–æ–≥–∏—è", "–ù–µ–æ–Ω–∞—Ç–æ–ª–æ–≥–∏—è", "–•–∏—Ä—É—Ä–≥–∏—è"]
    },
    {
        "name": "–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –Ω–∞—É—á–Ω—ã–π —Ü–µ–Ω—Ç—Ä –æ–Ω–∫–æ–ª–æ–≥–∏–∏ –∏ —Ç—Ä–∞–Ω—Å–ø–ª–∞–Ω—Ç–æ–ª–æ–≥–∏–∏",
        "city": "–ê—Å—Ç–∞–Ω–∞",
        "address": "—É–ª. “ö–∞–∂—ã–º“±“õ–∞–Ω, 3",
        "phone": "+7 (7172) 70-99-90",
        "specialties": ["–û–Ω–∫–æ–ª–æ–≥–∏—è", "–¢—Ä–∞–Ω—Å–ø–ª–∞–Ω—Ç–æ–ª–æ–≥–∏—è", "–•–∏–º–∏–æ—Ç–µ—Ä–∞–ø–∏—è"]
    },
    {
        "name": "–ì–æ—Ä–æ–¥—Å–∫–∞—è –ø–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∞ ‚Ññ1",
        "city": "–ê–ª–º–∞—Ç—ã",
        "address": "—É–ª. –ê–±–∞—è, 143",
        "phone": "+7 (727) 292-58-37",
        "specialties": ["–¢–µ—Ä–∞–ø–∏—è", "–ö–∞—Ä–¥–∏–æ–ª–æ–≥–∏—è", "–ù–µ–≤—Ä–æ–ª–æ–≥–∏—è", "–≠–Ω–¥–æ–∫—Ä–∏–Ω–æ–ª–æ–≥–∏—è"]
    },
    {
        "name": "–†–µ—Å–ø—É–±–ª–∏–∫–∞–Ω—Å–∫–∏–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä",
        "city": "–ê—Å—Ç–∞–Ω–∞",
        "address": "–ø—Ä. –°–∞—Ä—ã–∞—Ä–∫–∞, 31",
        "phone": "+7 (7172) 70-97-00",
        "specialties": ["–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞", "–ú–†–¢", "–ö–¢", "–£–ó–ò", "–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞"]
    },
    {
        "name": "–û–±–ª–∞—Å—Ç–Ω–∞—è –±–æ–ª—å–Ω–∏—Ü–∞",
        "city": "–ö–∞—Ä–∞–≥–∞–Ω–¥–∞",
        "address": "—É–ª. –ï—Ä—É–±–∞–µ–≤–∞, 49",
        "phone": "+7 (7212) 50-10-03",
        "specialties": ["–•–∏—Ä—É—Ä–≥–∏—è", "–¢—Ä–∞–≤–º–∞—Ç–æ–ª–æ–≥–∏—è", "–¢–µ—Ä–∞–ø–∏—è", "–ö–∞—Ä–¥–∏–æ–ª–æ–≥–∏—è"]
    },
    {
        "name": "–ì–æ—Ä–æ–¥—Å–∫–∞—è –±–æ–ª—å–Ω–∏—Ü–∞ ‚Ññ1",
        "city": "–®—ã–º–∫–µ–Ω—Ç",
        "address": "—É–ª. –ñ–µ–ª—Ç–æ–∫—Å–∞–Ω, 1",
        "phone": "+7 (7252) 53-45-67",
        "specialties": ["–¢–µ—Ä–∞–ø–∏—è", "–•–∏—Ä—É—Ä–≥–∏—è", "–ì–∏–Ω–µ–∫–æ–ª–æ–≥–∏—è", "–ü–µ–¥–∏–∞—Ç—Ä–∏—è"]
    },
    {
        "name": "–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä –ó–¥–æ—Ä–æ–≤—å–µ",
        "city": "–ê–ª–º–∞—Ç—ã",
        "address": "–º–∫—Ä. –°–∞–º–∞–ª-2, –¥. 58",
        "phone": "+7 (727) 250-90-90",
        "specialties": ["–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥–∏—è", "–ö–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—è", "–û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥–∏—è"]
    },
    {
        "name": "–ö–ª–∏–Ω–∏–∫–∞ –ù–µ–π—Ä–æ—Ö–∏—Ä—É—Ä–≥–∏–∏",
        "city": "–ê—Å—Ç–∞–Ω–∞",
        "address": "—É–ª. –ö–µ–Ω–µ—Å–∞—Ä—ã, 74",
        "phone": "+7 (7172) 54-54-54",
        "specialties": ["–ù–µ–π—Ä–æ—Ö–∏—Ä—É—Ä–≥–∏—è", "–ù–µ–≤—Ä–æ–ª–æ–≥–∏—è", "–†–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏—è"]
    },
    {
        "name": "–†–µ—Å–ø—É–±–ª–∏–∫–∞–Ω—Å–∫–∏–π –∫–æ–∂–Ω–æ-–≤–µ–Ω–µ—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –¥–∏—Å–ø–∞–Ω—Å–µ—Ä",
        "city": "–ê–ª–º–∞—Ç—ã",
        "address": "—É–ª. –ñ–∞–Ω–¥–æ—Å–æ–≤–∞, 73",
        "phone": "+7 (727) 378-50-50",
        "specialties": ["–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥–∏—è", "–í–µ–Ω–µ—Ä–æ–ª–æ–≥–∏—è", "–ú–∏–∫–æ–ª–æ–≥–∏—è"]
    },
    {
        "name": "–ì–æ—Ä–æ–¥—Å–∫–∞—è –ø–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∞ ‚Ññ5",
        "city": "–ö–∞—Ä–∞–≥–∞–Ω–¥–∞",
        "address": "–ø—Ä. –ë—É—Ö–∞—Ä-–ñ—ã—Ä–∞—É, 66",
        "phone": "+7 (7212) 42-15-88",
        "specialties": ["–¢–µ—Ä–∞–ø–∏—è", "–ü–µ–¥–∏–∞—Ç—Ä–∏—è", "–•–∏—Ä—É—Ä–≥–∏—è"]
    }
]

# –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –±–∞–∑–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤
DISEASE_SPECIALISTS = {
    "–ê–∫–Ω–µ": ["–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥", "–ö–æ—Å–º–µ—Ç–æ–ª–æ–≥", "–≠–Ω–¥–æ–∫—Ä–∏–Ω–æ–ª–æ–≥"],
    "–≠–∫–∑–µ–º–∞": ["–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥", "–ê–ª–ª–µ—Ä–≥–æ–ª–æ–≥", "–ò–º–º—É–Ω–æ–ª–æ–≥"],
    "–ü—Å–æ—Ä–∏–∞–∑": ["–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥", "–†–µ–≤–º–∞—Ç–æ–ª–æ–≥", "–ò–º–º—É–Ω–æ–ª–æ–≥"],
    "–ö—Ä–∞–ø–∏–≤–Ω–∏—Ü–∞": ["–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥", "–ê–ª–ª–µ—Ä–≥–æ–ª–æ–≥"],
    "–†–æ–∑–∞—Ü–µ–∞": ["–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥", "–ö–æ—Å–º–µ—Ç–æ–ª–æ–≥"],
    "–î–µ—Ä–º–∞—Ç–∏—Ç": ["–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥", "–ê–ª–ª–µ—Ä–≥–æ–ª–æ–≥"],
    "–í–∏—Ç–∏–ª–∏–≥–æ": ["–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥", "–ò–º–º—É–Ω–æ–ª–æ–≥"],
    "–ú–µ–ª–∞–Ω–æ–º–∞": ["–û–Ω–∫–æ–ª–æ–≥", "–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥", "–•–∏—Ä—É—Ä–≥"],
    "–ë–∞–∑–∞–ª–∏–æ–º–∞": ["–û–Ω–∫–æ–ª–æ–≥", "–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥", "–•–∏—Ä—É—Ä–≥"],
    "–ì–µ—Ä–ø–µ—Å": ["–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥", "–ò–Ω—Ñ–µ–∫—Ü–∏–æ–Ω–∏—Å—Ç", "–ò–º–º—É–Ω–æ–ª–æ–≥"],
    "–ö–æ–Ω—ä—é–Ω–∫—Ç–∏–≤–∏—Ç": ["–û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥"],
    "–ö–∞—Ç–∞—Ä–∞–∫—Ç–∞": ["–û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥", "–•–∏—Ä—É—Ä–≥-–æ—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥"],
    "–Ø—á–º–µ–Ω—å": ["–û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥"],
    "–ì–ª–∞—É–∫–æ–º–∞": ["–û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥"],
    "–ë–ª–µ—Ñ–∞—Ä–∏—Ç": ["–û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥", "–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥"],
    "–•–∞–ª—è–∑–∏–æ–Ω": ["–û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥", "–•–∏—Ä—É—Ä–≥"],
    "–ö–µ—Ä–∞—Ç–∏—Ç": ["–û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥", "–ò–Ω—Ñ–µ–∫—Ü–∏–æ–Ω–∏—Å—Ç"],
    "–ì—Ä–∏–±–æ–∫ –Ω–æ–≥—Ç–µ–π": ["–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥", "–ú–∏–∫–æ–ª–æ–≥", "–ü–æ–¥–æ–ª–æ–≥"],
    "–¢—Ä–∞–≤–º–∞ –Ω–æ–≥—Ç—è": ["–¢—Ä–∞–≤–º–∞—Ç–æ–ª–æ–≥", "–•–∏—Ä—É—Ä–≥"],
    "–ü—Å–æ—Ä–∏–∞–∑ –Ω–æ–≥—Ç–µ–π": ["–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥", "–†–µ–≤–º–∞—Ç–æ–ª–æ–≥"],
    "–û–Ω–∏—Ö–æ–ª–∏–∑–∏—Å": ["–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥", "–≠–Ω–¥–æ–∫—Ä–∏–Ω–æ–ª–æ–≥"],
    "–ü–∞–Ω–∞—Ä–∏—Ü–∏–π": ["–•–∏—Ä—É—Ä–≥", "–¢—Ä–∞–≤–º–∞—Ç–æ–ª–æ–≥"],
    "–ü–Ω–µ–≤–º–æ–Ω–∏—è": ["–ü—É–ª—å–º–æ–Ω–æ–ª–æ–≥", "–¢–µ—Ä–∞–ø–µ–≤—Ç", "–ò–Ω—Ñ–µ–∫—Ü–∏–æ–Ω–∏—Å—Ç"],
    "–¢—É–±–µ—Ä–∫—É–ª–µ–∑": ["–§—Ç–∏–∑–∏–∞—Ç—Ä", "–ü—É–ª—å–º–æ–Ω–æ–ª–æ–≥"],
    "–ü–µ—Ä–µ–ª–æ–º": ["–¢—Ä–∞–≤–º–∞—Ç–æ–ª–æ–≥", "–û—Ä—Ç–æ–ø–µ–¥", "–•–∏—Ä—É—Ä–≥"],
    "–ü–Ω–µ–≤–º–æ—Ç–æ—Ä–∞–∫—Å": ["–¢–æ—Ä–∞–∫–∞–ª—å–Ω—ã–π —Ö–∏—Ä—É—Ä–≥", "–ü—É–ª—å–º–æ–Ω–æ–ª–æ–≥"],
    "–ü–ª–µ–≤—Ä–∏—Ç": ["–ü—É–ª—å–º–æ–Ω–æ–ª–æ–≥", "–¢–µ—Ä–∞–ø–µ–≤—Ç"]
}

# –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –±–∞–∑–∞ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π
DISEASE_DETAILS = {
    "–ê–∫–Ω–µ": {
        "name": "–ê–∫–Ω–µ (—É–≥—Ä–µ–≤–∞—è –±–æ–ª–µ–∑–Ω—å)",
        "category": "–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥–∏—è",
        "description": "–í–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ —Å–∞–ª—å–Ω—ã—Ö –∂–µ–ª–µ–∑, –ø—Ä–æ—è–≤–ª—è—é—â–µ–µ—Å—è —É–≥—Ä–µ–≤–æ–π —Å—ã–ø—å—é, –∫–æ–º–µ–¥–æ–Ω–∞–º–∏, –≤–æ—Å–ø–∞–ª–µ–Ω–Ω—ã–º–∏ –ø—Ä—ã—â–∞–º–∏. –ß–∞—â–µ –≤—Å–µ–≥–æ –ø–æ—Ä–∞–∂–∞–µ—Ç –ª–∏—Ü–æ, —Å–ø–∏–Ω—É –∏ –≥—Ä—É–¥—å.",
        "symptoms": ["–ü—Ä—ã—â–∏", "–£–≥—Ä–∏", "–ü–æ–∫—Ä–∞—Å–Ω–µ–Ω–∏–µ", "–í–æ—Å–ø–∞–ª–µ–Ω–∏—è", "–ñ–∏—Ä–Ω—ã–π –±–ª–µ—Å–∫ –∫–æ–∂–∏", "–ö–æ–º–µ–¥–æ–Ω—ã (—á–µ—Ä–Ω—ã–µ –∏ –±–µ–ª—ã–µ —Ç–æ—á–∫–∏)", "–†—É–±—Ü—ã –ø–æ—Å—Ç–∞–∫–Ω–µ"],
        "causes": ["–ì–æ—Ä–º–æ–Ω–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–æ—Å–æ–±–µ–Ω–Ω–æ –≤ –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤–æ–º –≤–æ–∑—Ä–∞—Å—Ç–µ)", "–ù–∞—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å", "–°—Ç—Ä–µ—Å—Å", "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ", "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —É—Ö–æ–¥ –∑–∞ –∫–æ–∂–µ–π", "–ü—Ä–∏–µ–º –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ª–µ–∫–∞—Ä—Å—Ç–≤"],
        "danger": "–ù–∏–∑–∫–∞—è –æ–ø–∞—Å–Ω–æ—Å—Ç—å, –Ω–æ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–ª—è—Ç—å —Ä—É–±—Ü—ã –∏ –ø–æ—Å—Ç–≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω—É—é –ø–∏–≥–º–µ–Ω—Ç–∞—Ü–∏—é. –í —Ä–µ–¥–∫–∏—Ö —Å–ª—É—á–∞—è—Ö —Ç—è–∂–µ–ª—ã–µ —Ñ–æ—Ä–º—ã –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º –ø—Ä–æ–±–ª–µ–º–∞–º.",
        "treatment": ["–ù–∞—Ä—É–∂–Ω—ã–µ —Ä–µ—Ç–∏–Ω–æ–∏–¥—ã", "–ê–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏ –º–µ—Å—Ç–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è", "–ë–µ–Ω–∑–æ–∏–ª –ø–µ—Ä–æ–∫—Å–∏–¥", "–°–∞–ª–∏—Ü–∏–ª–æ–≤–∞—è –∫–∏—Å–ª–æ—Ç–∞", "–õ–∞–∑–µ—Ä–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è", "–•–∏–º–∏—á–µ—Å–∫–∏–µ –ø–∏–ª–∏–Ω–≥–∏"],
        "prevention": ["–†–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ—á–∏—â–µ–Ω–∏–µ –∫–æ–∂–∏", "–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ", "–û—Ç–∫–∞–∑ –æ—Ç –∫—É—Ä–µ–Ω–∏—è", "–ò–∑–±–µ–≥–∞–Ω–∏–µ —Å—Ç—Ä–µ—Å—Å–æ–≤", "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ–∫–æ–º–µ–¥–æ–≥–µ–Ω–Ω–æ–π –∫–æ—Å–º–µ—Ç–∏–∫–∏"],
        "icd10": "L70",
        "severity": "–õ–µ–≥–∫–∞—è-—Å—Ä–µ–¥–Ω—è—è"
    },
    "–≠–∫–∑–µ–º–∞": {
        "name": "–≠–∫–∑–µ–º–∞ (–∞—Ç–æ–ø–∏—á–µ—Å–∫–∏–π –¥–µ—Ä–º–∞—Ç–∏—Ç)",
        "category": "–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥–∏—è",
        "description": "–•—Ä–æ–Ω–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ –∫–æ–∂–∏, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É—é—â–µ–µ—Å—è —Å–∏–ª—å–Ω—ã–º –∑—É–¥–æ–º, –ø–æ–∫—Ä–∞—Å–Ω–µ–Ω–∏–µ–º, —Å—É—Ö–æ—Å—Ç—å—é –∏ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º –ø—É–∑—ã—Ä—å–∫–æ–≤. –ß–∞—Å—Ç–æ –∏–º–µ–µ—Ç –∞–ª–ª–µ—Ä–≥–∏—á–µ—Å–∫—É—é –ø—Ä–∏—Ä–æ–¥—É.",
        "symptoms": ["–°–∏–ª—å–Ω—ã–π –∑—É–¥", "–ü–æ–∫—Ä–∞—Å–Ω–µ–Ω–∏–µ", "–°—É—Ö–æ—Å—Ç—å", "–®–µ–ª—É—à–µ–Ω–∏–µ", "–¢—Ä–µ—â–∏–Ω—ã", "–ú–æ–∫–Ω—É—Ç–∏–µ", "–ö–æ—Ä–∫–∏", "–ü—É–∑—ã—Ä—å–∫–∏"],
        "causes": ["–ê–ª–ª–µ—Ä–≥–∏—á–µ—Å–∫–∏–µ —Ä–µ–∞–∫—Ü–∏–∏", "–ì–µ–Ω–µ—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–µ–¥—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å", "–°—Ç—Ä–µ—Å—Å", "–ö–æ–Ω—Ç–∞–∫—Ç —Å —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—è–º–∏", "–°—É—Ö–æ—Å—Ç—å –∫–æ–∂–∏", "–ù–∞—Ä—É—à–µ–Ω–∏–µ –∏–º–º—É–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã"],
        "danger": "–°—Ä–µ–¥–Ω—è—è –æ–ø–∞—Å–Ω–æ—Å—Ç—å. –ú–æ–∂–µ—Ç –∏–Ω—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å—Å—è –±–∞–∫—Ç–µ—Ä–∏—è–º–∏ –∏–ª–∏ –≥—Ä–∏–±–∫–∞–º–∏. –•—Ä–æ–Ω–∏—á–µ—Å–∫–æ–µ —Ç–µ—á–µ–Ω–∏–µ —É—Ö—É–¥—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –∂–∏–∑–Ω–∏ –∏–∑-–∑–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –∑—É–¥–∞.",
        "treatment": ["–£–≤–ª–∞–∂–Ω—è—é—â–∏–µ –∫—Ä–µ–º—ã (—ç–º–æ–ª–µ–Ω—Ç—ã)", "–ö–æ—Ä—Ç–∏–∫–æ—Å—Ç–µ—Ä–æ–∏–¥–Ω—ã–µ –º–∞–∑–∏", "–ê–Ω—Ç–∏–≥–∏—Å—Ç–∞–º–∏–Ω–Ω—ã–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã", "–§–æ—Ç–æ—Ç–µ—Ä–∞–ø–∏—è", "–ò–º–º—É–Ω–æ–¥–µ–ø—Ä–µ—Å—Å–∞–Ω—Ç—ã (—Ç–∞–∫—Ä–æ–ª–∏–º—É—Å)", "–ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã"],
        "prevention": ["–ò–∑–±–µ–≥–∞–Ω–∏–µ –∞–ª–ª–µ—Ä–≥–µ–Ω–æ–≤", "–†–µ–≥—É–ª—è—Ä–Ω–æ–µ —É–≤–ª–∞–∂–Ω–µ–Ω–∏–µ –∫–æ–∂–∏", "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º—è–≥–∫–∏—Ö –º–æ—é—â–∏—Ö —Å—Ä–µ–¥—Å—Ç–≤", "–ù–æ—à–µ–Ω–∏–µ —Ö–ª–æ–ø—á–∞—Ç–æ–±—É–º–∞–∂–Ω–æ–π –æ–¥–µ–∂–¥—ã"],
        "icd10": "L20-L30",
        "severity": "–°—Ä–µ–¥–Ω—è—è"
    },
    "–ü—Å–æ—Ä–∏–∞–∑": {
        "name": "–ü—Å–æ—Ä–∏–∞–∑",
        "category": "–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥–∏—è",
        "description": "–•—Ä–æ–Ω–∏—á–µ—Å–∫–æ–µ –Ω–µ–∏–Ω—Ñ–µ–∫—Ü–∏–æ–Ω–Ω–æ–µ –∞—É—Ç–æ–∏–º–º—É–Ω–Ω–æ–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ, –ø—Ä–æ—è–≤–ª—è—é—â–µ–µ—Å—è –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º –∫—Ä–∞—Å–Ω—ã—Ö –±–ª—è—à–µ–∫ —Å —Å–µ—Ä–µ–±—Ä–∏—Å—Ç—ã–º–∏ —á–µ—à—É–π–∫–∞–º–∏. –ß–∞—â–µ –ø–æ—Ä–∞–∂–∞–µ—Ç –ª–æ–∫—Ç–∏, –∫–æ–ª–µ–Ω–∏, –≤–æ–ª–æ—Å–∏—Å—Ç—É—é —á–∞—Å—Ç—å –≥–æ–ª–æ–≤—ã.",
        "symptoms": ["–ö—Ä–∞—Å–Ω—ã–µ –±–ª—è—à–∫–∏ —Å —Å–µ—Ä–µ–±—Ä–∏—Å—Ç—ã–º–∏ —á–µ—à—É–π–∫–∞–º–∏", "–ó—É–¥", "–°—É—Ö–æ—Å—Ç—å", "–¢—Ä–µ—â–∏–Ω—ã", "–®–µ–ª—É—à–µ–Ω–∏–µ", "–ë–æ–ª—å –≤ —Å—É—Å—Ç–∞–≤–∞—Ö (–ø—Ä–∏ –ø—Å–æ—Ä–∏–∞—Ç–∏—á–µ—Å–∫–æ–º –∞—Ä—Ç—Ä–∏—Ç–µ)", "–ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–æ–≥—Ç–µ–π"],
        "causes": ["–ê—É—Ç–æ–∏–º–º—É–Ω–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è", "–ù–∞—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å", "–°—Ç—Ä–µ—Å—Å", "–ò–Ω—Ñ–µ–∫—Ü–∏–∏", "–¢—Ä–∞–≤–º—ã –∫–æ–∂–∏", "–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞", "–ê–ª–∫–æ–≥–æ–ª—å", "–ö—É—Ä–µ–Ω–∏–µ"],
        "danger": "–°—Ä–µ–¥–Ω—è—è –æ–ø–∞—Å–Ω–æ—Å—Ç—å. –ú–æ–∂–µ—Ç –æ—Å–ª–æ–∂–Ω—è—Ç—å—Å—è –ø—Å–æ—Ä–∏–∞—Ç–∏—á–µ—Å–∫–∏–º –∞—Ä—Ç—Ä–∏—Ç–æ–º (—É 30% –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤). –ü–æ–≤—ã—à–∞–µ—Ç —Ä–∏—Å–∫ —Å–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç—ã—Ö –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π –∏ –º–µ—Ç–∞–±–æ–ª–∏—á–µ—Å–∫–æ–≥–æ —Å–∏–Ω–¥—Ä–æ–º–∞.",
        "treatment": ["–ú–µ—Å—Ç–Ω—ã–µ –∫–æ—Ä—Ç–∏–∫–æ—Å—Ç–µ—Ä–æ–∏–¥—ã", "–í–∏—Ç–∞–º–∏–Ω D –∞–Ω–∞–ª–æ–≥–∏ (–∫–∞–ª—å—Ü–∏–ø–æ—Ç—Ä–∏–æ–ª)", "–§–æ—Ç–æ—Ç–µ—Ä–∞–ø–∏—è (–£–§–ë, –ü–£–í–ê)", "–°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã (–º–µ—Ç–æ—Ç—Ä–µ–∫—Å–∞—Ç, —Ü–∏–∫–ª–æ—Å–ø–æ—Ä–∏–Ω)", "–ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Ç–µ—Ä–∞–ø–∏—è (–∏–Ω–≥–∏–±–∏—Ç–æ—Ä—ã –§–ù–û-Œ±, –ò–õ-17, –ò–õ-23)"],
        "prevention": ["–ò–∑–±–µ–≥–∞–Ω–∏–µ —Ç—Ä–∞–≤–º –∫–æ–∂–∏", "–°–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç—Ä–µ—Å—Å–∞", "–û—Ç–∫–∞–∑ –æ—Ç –∫—É—Ä–µ–Ω–∏—è –∏ –∞–ª–∫–æ–≥–æ–ª—è", "–ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –∑–¥–æ—Ä–æ–≤–æ–≥–æ –≤–µ—Å–∞", "–ò–∑–±–µ–≥–∞–Ω–∏–µ –ø—Ä–æ–≤–æ—Ü–∏—Ä—É—é—â–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤"],
        "icd10": "L40",
        "severity": "–°—Ä–µ–¥–Ω—è—è-–≤—ã—Å–æ–∫–∞—è"
    },
    "–ú–µ–ª–∞–Ω–æ–º–∞": {
        "name": "–ú–µ–ª–∞–Ω–æ–º–∞",
        "category": "–û–Ω–∫–æ–ª–æ–≥–∏—è",
        "description": "–ó–ª–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –æ–ø—É—Ö–æ–ª—å, —Ä–∞–∑–≤–∏–≤–∞—é—â–∞—è—Å—è –∏–∑ –º–µ–ª–∞–Ω–æ—Ü–∏—Ç–æ–≤ (–ø–∏–≥–º–µ–Ω—Ç–Ω—ã—Ö –∫–ª–µ—Ç–æ–∫ –∫–æ–∂–∏). –û–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã—Ö –≤–∏–¥–æ–≤ —Ä–∞–∫–∞ –∫–æ–∂–∏.",
        "symptoms": ["–ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–∞—è —Ä–æ–¥–∏–Ω–∫–∞", "–ù–µ—Ä–æ–≤–Ω—ã–µ –∫—Ä–∞—è", "–ù–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–∞—è –æ–∫—Ä–∞—Å–∫–∞", "–î–∏–∞–º–µ—Ç—Ä –±–æ–ª–µ–µ 6 –º–º", "–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞, —Ñ–æ—Ä–º—ã –∏–ª–∏ —Ü–≤–µ—Ç–∞", "–ö—Ä–æ–≤–æ—Ç–æ—á–∏–≤–æ—Å—Ç—å", "–ó—É–¥"],
        "causes": ["–ß—Ä–µ–∑–º–µ—Ä–Ω–æ–µ –£–§-–∏–∑–ª—É—á–µ–Ω–∏–µ", "–°–æ–ª–Ω–µ—á–Ω—ã–µ –æ–∂–æ–≥–∏", "–ì–µ–Ω–µ—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–µ–¥—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å", "–ë–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–æ–¥–∏–Ω–æ–∫", "–°–≤–µ—Ç–ª–∞—è –∫–æ–∂–∞"],
        "danger": "–û–ß–ï–ù–¨ –í–´–°–û–ö–ê–Ø –û–ü–ê–°–ù–û–°–¢–¨. –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Ä–∞–∫ —Å –≤—ã—Å–æ–∫–∏–º —Ä–∏—Å–∫–æ–º –º–µ—Ç–∞—Å—Ç–∞–∑–∏—Ä–æ–≤–∞–Ω–∏—è. –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ª–µ—á–µ–Ω–∏—è –ª–µ—Ç–∞–ª—å–Ω—ã–π –∏—Å—Ö–æ–¥. –¢—Ä–µ–±—É–µ—Ç –ù–ï–ú–ï–î–õ–ï–ù–ù–û–ì–û –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –æ–Ω–∫–æ–ª–æ–≥—É!",
        "treatment": ["–•–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ", "–ò–º–º—É–Ω–æ—Ç–µ—Ä–∞–ø–∏—è", "–¢–∞—Ä–≥–µ—Ç–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è", "–•–∏–º–∏–æ—Ç–µ—Ä–∞–ø–∏—è", "–õ—É—á–µ–≤–∞—è —Ç–µ—Ä–∞–ø–∏—è"],
        "prevention": ["–ó–∞—â–∏—Ç–∞ –æ—Ç —Å–æ–ª–Ω—Ü–∞ (SPF 50+)", "–ò–∑–±–µ–≥–∞–Ω–∏–µ —Å–æ–ª—è—Ä–∏–µ–≤", "–†–µ–≥—É–ª—è—Ä–Ω—ã–π –æ—Å–º–æ—Ç—Ä —Ä–æ–¥–∏–Ω–æ–∫", "–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–µ–≤—É—Å–æ–≤"],
        "icd10": "C43",
        "severity": "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è"
    },
    "–ö–∞—Ç–∞—Ä–∞–∫—Ç–∞": {
        "name": "–ö–∞—Ç–∞—Ä–∞–∫—Ç–∞",
        "category": "–û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥–∏—è",
        "description": "–ü–æ–º—É—Ç–Ω–µ–Ω–∏–µ —Ö—Ä—É—Å—Ç–∞–ª–∏–∫–∞ –≥–ª–∞–∑–∞, –ø—Ä–∏–≤–æ–¥—è—â–µ–µ –∫ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–º—É —É—Ö—É–¥—à–µ–Ω–∏—é –∑—Ä–µ–Ω–∏—è. –ß–∞—â–µ –≤—Å–µ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ.",
        "symptoms": ["–ó–∞—Ç—É–º–∞–Ω–µ–Ω–Ω–æ–µ –∑—Ä–µ–Ω–∏–µ", "–ë–ª–∏–∫–∏ –∏ –æ—Ä–µ–æ–ª—ã –≤–æ–∫—Ä—É–≥ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Å–≤–µ—Ç–∞", "–£—Ö—É–¥—à–µ–Ω–∏–µ –Ω–æ—á–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è", "–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤–æ—Å–ø—Ä–∏—è—Ç–∏—è", "–î–≤–æ–µ–Ω–∏–µ –≤ –æ–¥–Ω–æ–º –≥–ª–∞–∑—É", "–ß–∞—Å—Ç–∞—è —Å–º–µ–Ω–∞ –æ—á–∫–æ–≤"],
        "causes": ["–í–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è", "–¢—Ä–∞–≤–º—ã –≥–ª–∞–∑–∞", "–î–∏–∞–±–µ—Ç", "–ù–∞—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å", "–î–ª–∏—Ç–µ–ª—å–Ω–æ–µ –£–§-–∏–∑–ª—É—á–µ–Ω–∏–µ", "–ö—É—Ä–µ–Ω–∏–µ", "–î–ª–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–∏–µ–º –∫–æ—Ä—Ç–∏–∫–æ—Å—Ç–µ—Ä–æ–∏–¥–æ–≤"],
        "danger": "–í—ã—Å–æ–∫–∞—è –æ–ø–∞—Å–Ω–æ—Å—Ç—å. –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ–ª–Ω–æ–π –ø–æ—Ç–µ—Ä–µ –∑—Ä–µ–Ω–∏—è. –Ø–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏—á–∏–Ω–æ–π —Å–ª–µ–ø–æ—Ç—ã –≤–æ –≤—Å–µ–º –º–∏—Ä–µ. –¢—Ä–µ–±—É–µ—Ç —Ö–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–æ–≥–æ –ª–µ—á–µ–Ω–∏—è.",
        "treatment": ["–•–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –º—É—Ç–Ω–æ–≥–æ —Ö—Ä—É—Å—Ç–∞–ª–∏–∫–∞ (—Ñ–∞–∫–æ—ç–º—É–ª—å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è)", "–ò–º–ø–ª–∞–Ω—Ç–∞—Ü–∏—è –∏–Ω—Ç—Ä–∞–æ–∫—É–ª—è—Ä–Ω–æ–π –ª–∏–Ω–∑—ã (–ò–û–õ)", "–õ–∞–∑–µ—Ä–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –≤—Ç–æ—Ä–∏—á–Ω–æ–π –∫–∞—Ç–∞—Ä–∞–∫—Ç—ã"],
        "prevention": ["–ó–∞—â–∏—Ç–∞ –≥–ª–∞–∑ –æ—Ç –£–§-–∏–∑–ª—É—á–µ–Ω–∏—è (—Å–æ–ª–Ω—Ü–µ–∑–∞—â–∏—Ç–Ω—ã–µ –æ—á–∫–∏)", "–û—Ç–∫–∞–∑ –æ—Ç –∫—É—Ä–µ–Ω–∏—è", "–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–∏–∞–±–µ—Ç–∞", "–ó–¥–æ—Ä–æ–≤–æ–µ –ø–∏—Ç–∞–Ω–∏–µ —Å –∞–Ω—Ç–∏–æ–∫—Å–∏–¥–∞–Ω—Ç–∞–º–∏"],
        "icd10": "H25-H26",
        "severity": "–í—ã—Å–æ–∫–∞—è"
    },
    "–ü–Ω–µ–≤–º–æ–Ω–∏—è": {
        "name": "–ü–Ω–µ–≤–º–æ–Ω–∏—è (–≤–æ—Å–ø–∞–ª–µ–Ω–∏–µ –ª–µ–≥–∫–∏—Ö)",
        "category": "–ü—É–ª—å–º–æ–Ω–æ–ª–æ–≥–∏—è",
        "description": "–û—Å—Ç—Ä–æ–µ –∏–Ω—Ñ–µ–∫—Ü–∏–æ–Ω–Ω–æ–µ –≤–æ—Å–ø–∞–ª–µ–Ω–∏–µ –ª–µ–≥–æ—á–Ω–æ–π —Ç–∫–∞–Ω–∏ —Å –ø–æ—Ä–∞–∂–µ–Ω–∏–µ–º –∞–ª—å–≤–µ–æ–ª. –ú–æ–∂–µ—Ç –±—ã—Ç—å –±–∞–∫—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–π, –≤–∏—Ä—É—Å–Ω–æ–π –∏–ª–∏ –≥—Ä–∏–±–∫–æ–≤–æ–π –ø—Ä–∏—Ä–æ–¥—ã.",
        "symptoms": ["–í—ã—Å–æ–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (38-40¬∞C)", "–ö–∞—à–µ–ª—å —Å –º–æ–∫—Ä–æ—Ç–æ–π", "–û–¥—ã—à–∫–∞", "–ë–æ–ª—å –≤ –≥—Ä—É–¥–∏ –ø—Ä–∏ –¥—ã—Ö–∞–Ω–∏–∏", "–°–ª–∞–±–æ—Å—Ç—å", "–ü–æ—Ç–ª–∏–≤–æ—Å—Ç—å", "–£—á–∞—â–µ–Ω–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ"],
        "causes": ["–ë–∞–∫—Ç–µ—Ä–∏–∏ (–ø–Ω–µ–≤–º–æ–∫–æ–∫–∫, —Å—Ç–∞—Ñ–∏–ª–æ–∫–æ–∫–∫)", "–í–∏—Ä—É—Å—ã (–≥—Ä–∏–ø–ø, COVID-19)", "–ì—Ä–∏–±–∫–∏", "–ü–µ—Ä–µ–æ—Ö–ª–∞–∂–¥–µ–Ω–∏–µ", "–°–Ω–∏–∂–µ–Ω–∏–µ –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞"],
        "danger": "–í–´–°–û–ö–ê–Ø –û–ü–ê–°–ù–û–°–¢–¨! –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å–º–µ—Ä—Ç–µ–ª—å–Ω–∞, –æ—Å–æ–±–µ–Ω–Ω–æ —É –¥–µ—Ç–µ–π, –ø–æ–∂–∏–ª—ã—Ö –∏ –æ—Å–ª–∞–±–ª–µ–Ω–Ω—ã—Ö –ª—é–¥–µ–π. –¢—Ä–µ–±—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ª–µ—á–µ–Ω–∏—è –∞–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∞–º–∏ –∏ –≤—Ä–∞—á–µ–±–Ω–æ–≥–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è.",
        "treatment": ["–ê–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏ (–∞–º–æ–∫—Å–∏—Ü–∏–ª–ª–∏–Ω, –∞–∑–∏—Ç—Ä–æ–º–∏—Ü–∏–Ω, —Ü–µ—Ñ—Ç—Ä–∏–∞–∫—Å–æ–Ω)", "–ü—Ä–æ—Ç–∏–≤–æ–≤–∏—Ä—É—Å–Ω—ã–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã", "–ñ–∞—Ä–æ–ø–æ–Ω–∏–∂–∞—é—â–∏–µ", "–û–±–∏–ª—å–Ω–æ–µ –ø–∏—Ç—å–µ", "–ì–æ—Å–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Ç—è–∂–µ–ª—ã—Ö —Ñ–æ—Ä–º–∞—Ö", "–û–∫—Å–∏–≥–µ–Ω–æ—Ç–µ—Ä–∞–ø–∏—è"],
        "prevention": ["–í–∞–∫—Ü–∏–Ω–∞—Ü–∏—è (–ø–Ω–µ–≤–º–æ–∫–æ–∫–∫–æ–≤–∞—è –≤–∞–∫—Ü–∏–Ω–∞, –≤–∞–∫—Ü–∏–Ω–∞ –æ—Ç –≥—Ä–∏–ø–ø–∞)", "–ó–¥–æ—Ä–æ–≤—ã–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏", "–ò–∑–±–µ–≥–∞–Ω–∏–µ –ø–µ—Ä–µ–æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è", "–£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞"],
        "icd10": "J12-J18",
        "severity": "–í—ã—Å–æ–∫–∞—è"
    },
    "–¢—É–±–µ—Ä–∫—É–ª–µ–∑": {
        "name": "–¢—É–±–µ—Ä–∫—É–ª–µ–∑ –ª–µ–≥–∫–∏—Ö",
        "category": "–§—Ç–∏–∑–∏–∞—Ç—Ä–∏—è",
        "description": "–ò–Ω—Ñ–µ–∫—Ü–∏–æ–Ω–Ω–æ–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ, –≤—ã–∑—ã–≤–∞–µ–º–æ–µ –º–∏–∫–æ–±–∞–∫—Ç–µ—Ä–∏–µ–π —Ç—É–±–µ—Ä–∫—É–ª–µ–∑–∞ (–ø–∞–ª–æ—á–∫–∞ –ö–æ—Ö–∞). –ü–æ—Ä–∞–∂–∞–µ—Ç –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –ª–µ–≥–∫–∏–µ, –Ω–æ –º–æ–∂–µ—Ç –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—Ç—å –∏ –¥—Ä—É–≥–∏–µ –æ—Ä–≥–∞–Ω—ã.",
        "symptoms": ["–î–ª–∏—Ç–µ–ª—å–Ω—ã–π –∫–∞—à–µ–ª—å (–±–æ–ª–µ–µ 3 –Ω–µ–¥–µ–ª—å)", "–ö—Ä–æ–≤–æ—Ö–∞—Ä–∫–∞–Ω—å–µ", "–ü–æ—Ç–µ—Ä—è –≤–µ—Å–∞", "–ù–æ—á–Ω–∞—è –ø–æ—Ç–ª–∏–≤–æ—Å—Ç—å", "–°—É–±—Ñ–µ–±—Ä–∏–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞", "–°–ª–∞–±–æ—Å—Ç—å", "–ë–æ–ª—å –≤ –≥—Ä—É–¥–∏"],
        "causes": ["–ú–∏–∫–æ–±–∞–∫—Ç–µ—Ä–∏—è —Ç—É–±–µ—Ä–∫—É–ª–µ–∑–∞ (Mycobacterium tuberculosis)", "–í–æ–∑–¥—É—à–Ω–æ-–∫–∞–ø–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞", "–°–Ω–∏–∂–µ–Ω–∏–µ –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞", "–¢–µ—Å–Ω—ã–π –∫–æ–Ω—Ç–∞–∫—Ç —Å –±–æ–ª—å–Ω—ã–º"],
        "danger": "–û–ß–ï–ù–¨ –í–´–°–û–ö–ê–Ø –û–ü–ê–°–ù–û–°–¢–¨! –ó–∞—Ä–∞–∑–Ω–æ–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ. –ë–µ–∑ –ª–µ—á–µ–Ω–∏—è –ª–µ—Ç–∞–ª—å–Ω–æ—Å—Ç—å –¥–æ 50%. –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ä–∞–∑—Ä—É—à–µ–Ω–∏—é –ª–µ–≥–∫–∏—Ö –∏ —Å–º–µ—Ä—Ç–∏. –¢—Ä–µ–±—É–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ª–µ—á–µ–Ω–∏—è –≤ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É—á—Ä–µ–∂–¥–µ–Ω–∏—è—Ö.",
        "treatment": ["–î–ª–∏—Ç–µ–ª—å–Ω–∞—è –∞–Ω—Ç–∏–±–∞–∫—Ç–µ—Ä–∏–∞–ª—å–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è (6-12 –º–µ—Å—è—Ü–µ–≤)", "–ö–æ–º–±–∏–Ω–∞—Ü–∏—è –∏–∑ 4-5 –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤ (–∏–∑–æ–Ω–∏–∞–∑–∏–¥, —Ä–∏—Ñ–∞–º–ø–∏—Ü–∏–Ω, –ø–∏—Ä–∞–∑–∏–Ω–∞–º–∏–¥, —ç—Ç–∞–º–±—É—Ç–æ–ª)", "–ì–æ—Å–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è –≤ —Ç—É–±–¥–∏—Å–ø–∞–Ω—Å–µ—Ä", "–ö–æ–Ω—Ç—Ä–æ–ª—å –∏–∑–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏"],
        "prevention": ["–í–∞–∫—Ü–∏–Ω–∞—Ü–∏—è –ë–¶–ñ –≤ –¥–µ—Ç—Å—Ç–≤–µ", "–ò–∑–±–µ–≥–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞ —Å –±–æ–ª—å–Ω—ã–º–∏", "–§–ª—é–æ—Ä–æ–≥—Ä–∞—Ñ–∏—è 1 —Ä–∞–∑ –≤ –≥–æ–¥", "–ó–¥–æ—Ä–æ–≤—ã–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏", "–£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞"],
        "icd10": "A15-A19",
        "severity": "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è"
    },
    # –î–æ–±–∞–≤–∏–º –µ—â–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã –±–∞–∑—ã
    "–†–æ–∑–∞—Ü–µ–∞": {
        "name": "–†–æ–∑–∞—Ü–µ–∞",
        "category": "–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥–∏—è",
        "description": "–•—Ä–æ–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ –∫–æ–∂–∏ –ª–∏—Ü–∞, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É—é—â–µ–µ—Å—è –ø–æ–∫—Ä–∞—Å–Ω–µ–Ω–∏–µ–º, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º —Å–æ—Å—É–¥–æ–≤ –∏ –≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω—ã–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏.",
        "symptoms": ["–ü–æ–∫—Ä–∞—Å–Ω–µ–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π —á–∞—Å—Ç–∏ –ª–∏—Ü–∞", "–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Å–æ—Å—É–¥—ã", "–ü–∞–ø—É–ª—ã –∏ –ø—É—Å—Ç—É–ª—ã", "–£—Ç–æ–ª—â–µ–Ω–∏–µ –∫–æ–∂–∏ –Ω–æ—Å–∞"],
        "causes": ["–ì–µ–Ω–µ—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–µ–¥—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å", "–°–æ—Å—É–¥–∏—Å—Ç—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è", "–î–µ–º–æ–¥–µ–∫—Å", "–¢—Ä–∏–≥–≥–µ—Ä—ã (–∞–ª–∫–æ–≥–æ–ª—å, –æ—Å—Ç—Ä–∞—è –ø–∏—â–∞, —Å—Ç—Ä–µ—Å—Å)"],
        "danger": "–ù–∏–∑–∫–∞—è-—Å—Ä–µ–¥–Ω—è—è. –ù–µ –æ–ø–∞—Å–Ω–∞ –¥–ª—è –∂–∏–∑–Ω–∏, –Ω–æ —Å–Ω–∏–∂–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –∂–∏–∑–Ω–∏.",
        "treatment": ["–ú–µ—Ç—Ä–æ–Ω–∏–¥–∞–∑–æ–ª –º–µ—Å—Ç–Ω–æ", "–ê–∑–µ–ª–∞–∏–Ω–æ–≤–∞—è –∫–∏—Å–ª–æ—Ç–∞", "–õ–∞–∑–µ—Ä–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è", "–ò–∑–±–µ–≥–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤"],
        "prevention": ["–ó–∞—â–∏—Ç–∞ –æ—Ç —Å–æ–ª–Ω—Ü–∞", "–ò–∑–±–µ–≥–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤", "–ú—è–≥–∫–∏–π —É—Ö–æ–¥ –∑–∞ –∫–æ–∂–µ–π"],
        "icd10": "L71",
        "severity": "–õ–µ–≥–∫–∞—è-—Å—Ä–µ–¥–Ω—è—è"
    },
    "–ì–ª–∞—É–∫–æ–º–∞": {
        "name": "–ì–ª–∞—É–∫–æ–º–∞",
        "category": "–û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥–∏—è",
        "description": "–ì—Ä—É–ø–ø–∞ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É—é—â–∏—Ö—Å—è –ø–æ–≤—ã—à–µ–Ω–∏–µ–º –≤–Ω—É—Ç—Ä–∏–≥–ª–∞–∑–Ω–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è –∏ –ø–æ—Ä–∞–∂–µ–Ω–∏–µ–º –∑—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –Ω–µ—Ä–≤–∞.",
        "symptoms": ["–°—É–∂–µ–Ω–∏–µ –ø–æ–ª–µ–π –∑—Ä–µ–Ω–∏—è", "–†–∞–¥—É–∂–Ω—ã–µ –∫—Ä—É–≥–∏ –≤–æ–∫—Ä—É–≥ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Å–≤–µ—Ç–∞", "–ì–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å", "–ë–æ–ª—å –≤ –≥–ª–∞–∑–∞—Ö", "–ó–∞—Ç—É–º–∞–Ω–∏–≤–∞–Ω–∏–µ –∑—Ä–µ–Ω–∏—è"],
        "causes": ["–ü–æ–≤—ã—à–µ–Ω–Ω–æ–µ –≤–Ω—É—Ç—Ä–∏–≥–ª–∞–∑–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ", "–ù–∞—Ä—É—à–µ–Ω–∏–µ –æ—Ç—Ç–æ–∫–∞ –≤–Ω—É—Ç—Ä–∏–≥–ª–∞–∑–Ω–æ–π –∂–∏–¥–∫–æ—Å—Ç–∏", "–í–æ–∑—Ä–∞—Å—Ç", "–ù–∞—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å"],
        "danger": "–í–´–°–û–ö–ê–Ø! –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ–π —Å–ª–µ–ø–æ—Ç–µ. –¢—Ä–µ–±—É–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –ª–µ—á–µ–Ω–∏—è –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è.",
        "treatment": ["–ì–ª–∞–∑–Ω—ã–µ –∫–∞–ø–ª–∏ (–±–µ—Ç–∞-–±–ª–æ–∫–∞—Ç–æ—Ä—ã, –ø—Ä–æ—Å—Ç–∞–≥–ª–∞–Ω–¥–∏–Ω—ã)", "–õ–∞–∑–µ—Ä–Ω–∞—è —Ç—Ä–∞–±–µ–∫—É–ª–æ–ø–ª–∞—Å—Ç–∏–∫–∞", "–•–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–æ–µ –ª–µ—á–µ–Ω–∏–µ"],
        "prevention": ["–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ—Å–º–æ—Ç—Ä—ã —É –æ—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥–∞", "–ö–æ–Ω—Ç—Ä–æ–ª—å –≤–Ω—É—Ç—Ä–∏–≥–ª–∞–∑–Ω–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è", "–ó–¥–æ—Ä–æ–≤—ã–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏"],
        "icd10": "H40",
        "severity": "–í—ã—Å–æ–∫–∞—è"
    }
}

# –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö
analyses_history = []
chat_history = []

def preprocess_image(image_data, target_size=(224, 224)):
    """–ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –º–æ–¥–µ–ª–∏"""
    try:
        if ',' in image_data:
            image_data = image_data.split(',')[1]
       
        image_bytes = base64.b64decode(image_data)
        image = Image.open(io.BytesIO(image_bytes))
       
        if image.mode != 'RGB':
            image = image.convert('RGB')
       
        image = image.resize(target_size)
        img_array = np.array(image) / 255.0
        img_array = np.expand_dims(img_array, axis=0)
       
        return img_array, image
       
    except Exception as e:
        print(f"Error preprocessing image: {e}")
        return None, None

def predict_with_model(model, image_array, disease_classes):
    """–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–¥–µ–ª–∏"""
    try:
        if model is None:
            # –î–ï–ú–û-–†–ï–ñ–ò–ú: —Å–ª—É—á–∞–π–Ω–æ –≤—ã–±–∏—Ä–∞–µ–º –±–æ–ª–µ–∑–Ω—å (–∫—Ä–æ–º–µ "–ù–æ—Ä–º–∞")
            import random
            non_normal = [d for d in disease_classes if d != "–ù–æ—Ä–º–∞"]
            if non_normal:
                disease_name = random.choice(non_normal)
                confidence = random.uniform(0.65, 0.95)
                is_normal = False
            else:
                disease_name = "–ù–æ—Ä–º–∞"
                confidence = 0.85
                is_normal = True
            return disease_name, confidence, is_normal
        
        predictions = model.predict(image_array, verbose=0)
        predicted_class_idx = np.argmax(predictions[0])
        confidence = float(predictions[0][predicted_class_idx])
        
        if predicted_class_idx < len(disease_classes):
            disease_name = disease_classes[predicted_class_idx]
        else:
            disease_name = "–ù–æ—Ä–º–∞"
        
        is_normal = (disease_name == "–ù–æ—Ä–º–∞")
        
        return disease_name, confidence, is_normal
        
    except Exception as e:
        print(f"Error in model prediction: {e}")
        # –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ —Ç–æ–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-—Ä–µ–∂–∏–º
        import random
        non_normal = [d for d in disease_classes if d != "–ù–æ—Ä–º–∞"]
        if non_normal:
            disease_name = random.choice(non_normal)
            confidence = random.uniform(0.65, 0.95)
            is_normal = False
        else:
            disease_name = "–ù–æ—Ä–º–∞"
            confidence = 0.85
            is_normal = True
        return disease_name, confidence, is_normal

def find_hospitals_for_disease(disease_name):
    """–ü–æ–∏—Å–∫ –±–æ–ª—å–Ω–∏—Ü –¥–ª—è –ª–µ—á–µ–Ω–∏—è –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è"""
    specialists = DISEASE_SPECIALISTS.get(disease_name, [])
    matching_hospitals = []
    
    for hospital in HOSPITALS_KAZAKHSTAN:
        for specialty in hospital['specialties']:
            for specialist in specialists:
                if specialist.lower() in specialty.lower() or specialty.lower() in specialist.lower():
                    if hospital not in matching_hospitals:
                        matching_hospitals.append(hospital)
                    break
    
    # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö, –¥–æ–±–∞–≤–∏–º –æ–±—â–∏–µ –±–æ–ª—å–Ω–∏—Ü—ã
    if len(matching_hospitals) < 3:
        for hospital in HOSPITALS_KAZAKHSTAN:
            if "–¢–µ—Ä–∞–ø–∏—è" in hospital['specialties'] and hospital not in matching_hospitals:
                matching_hospitals.append(hospital)
                if len(matching_hospitals) >= 5:
                    break
    
    return matching_hospitals[:5]

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/api/analyze', methods=['POST'])
def analyze_image():
    try:
        data = request.json
        image_data = data.get('image')
        analysis_type = data.get('type', 'skin')
       
        if not image_data:
            return jsonify({'error': 'No image provided'}), 400
       
        print(f"–ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Ç–∏–ø: {analysis_type}")
       
        image_array, original_image = preprocess_image(image_data)
        if image_array is None or original_image is None:
            return jsonify({'error': 'Failed to process image'}), 400
        
        # –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ –∏ –∫–ª–∞—Å—Å–æ–≤
        model = None
        disease_classes = []
        
        if analysis_type == 'skin':
            model = acne_model
            disease_classes = DISEASE_CLASSES['skin']
        elif analysis_type == 'eyes':
            model = eyes_model
            disease_classes = DISEASE_CLASSES['eyes']
        elif analysis_type == 'nails':
            model = nails_model
            disease_classes = DISEASE_CLASSES['nails']
        elif analysis_type == 'xray':
            model = xray_model
            disease_classes = DISEASE_CLASSES['xray']
        else:
            return jsonify({'error': 'Invalid analysis type'}), 400
        
        # –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
        disease_name, confidence, is_normal = predict_with_model(model, image_array, disease_classes)
        
        result = {
            'disease': {
                'name': disease_name,
                'probability': round(confidence * 100, 1),
                'is_normal': is_normal
            },
            'timestamp': datetime.now().isoformat(),
            'type': analysis_type,
        }
        
        # –î–æ–±–∞–≤–ª—è–µ–º –¥–µ—Ç–∞–ª–∏ –¢–û–õ–¨–ö–û –µ—Å–ª–∏ —ç—Ç–æ –ù–ï –Ω–æ—Ä–º–∞
        if not is_normal:
            print(f"–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ: {disease_name} ({confidence:.2f})")
            
            if disease_name in DISEASE_DETAILS:
                disease_info = DISEASE_DETAILS[disease_name]
                specialists = DISEASE_SPECIALISTS.get(disease_name, ["–¢–µ—Ä–∞–ø–µ–≤—Ç"])
                
                # –ù–∞—Ö–æ–¥–∏–º –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –±–æ–ª—å–Ω–∏—Ü—ã –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ
                hospitals = find_hospitals_for_disease(disease_name)
                
                recommendations = [
                    f"–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É: {', '.join(specialists)}",
                    "–ù–µ –∑–∞–Ω–∏–º–∞–π—Ç–µ—Å—å —Å–∞–º–æ–ª–µ—á–µ–Ω–∏–µ–º",
                    "–ü—Ä–æ–π–¥–∏—Ç–µ –ø–æ–ª–Ω–æ–µ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ",
                    "–°–ª–µ–¥—É–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º –≤—Ä–∞—á–∞"
                ]
                
                result['disease'].update({
                    'full_name': disease_info['name'],
                    'category': disease_info['category'],
                    'description': disease_info['description'],
                    'symptoms': disease_info['symptoms'],
                    'causes': disease_info['causes'],
                    'danger': disease_info['danger'],
                    'treatment': disease_info['treatment'],
                    'prevention': disease_info['prevention'],
                    'icd10': disease_info.get('icd10', 'N/A'),
                    'severity': disease_info.get('severity', '–°—Ä–µ–¥–Ω—è—è'),
                    'specialists': specialists,
                    'recommendations': recommendations,
                    'hospitals': hospitals
                })
                
                result['image_data'] = image_data
            else:
                result['disease'].update({
                    'description': f"–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–∏–∑–Ω–∞–∫–∏ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è: {disease_name}",
                    'specialists': ["–¢–µ—Ä–∞–ø–µ–≤—Ç"],
                    'recommendations': ["–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤—Ä–∞—á—É –¥–ª—è —Ç–æ—á–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏"],
                    'hospitals': find_hospitals_for_disease(disease_name)
                })
                result['image_data'] = image_data
        else:
            print(f"–ó–∞–±–æ–ª–µ–≤–∞–Ω–∏–π –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ (–ù–æ—Ä–º–∞)")
        
        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
        analysis_id = len(analyses_history) + 1
        analysis_record = {
            'id': analysis_id,
            'result': result,
            'type': analysis_type,
            'timestamp': datetime.now().isoformat()
        }
        analyses_history.append(analysis_record)
       
        return jsonify({
            'success': True,
            'analysis_id': analysis_id,
            'result': result
        })
       
    except Exception as e:
        print(f"Error in analyze_image: {str(e)}")
        traceback.print_exc()
        return jsonify({'error': str(e)}), 500

@app.route('/api/history', methods=['GET'])
def get_history():
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∞–Ω–∞–ª–∏–∑–æ–≤"""
    try:
        return jsonify({
            'success': True,
            'history': analyses_history
        })
    except Exception as e:
        return jsonify({'error': str(e)}), 500

@app.route('/api/history/<int:analysis_id>', methods=['GET'])
def get_analysis(analysis_id):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞"""
    try:
        for analysis in analyses_history:
            if analysis['id'] == analysis_id:
                return jsonify({
                    'success': True,
                    'analysis': analysis
                })
        return jsonify({'error': 'Analysis not found'}), 404
    except Exception as e:
        return jsonify({'error': str(e)}), 500

@app.route('/api/history/<int:analysis_id>', methods=['DELETE'])
def delete_analysis(analysis_id):
    """–£–¥–∞–ª–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏"""
    try:
        global analyses_history
        analyses_history = [a for a in analyses_history if a['id'] != analysis_id]
        return jsonify({
            'success': True,
            'message': 'Analysis deleted'
        })
    except Exception as e:
        return jsonify({'error': str(e)}), 500

@app.route('/api/diseases', methods=['GET'])
def get_diseases():
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π"""
    try:
        category = request.args.get('category', None)
        search = request.args.get('search', '').lower()
        severity = request.args.get('severity', None)
        
        diseases = []
        for disease_name, disease_info in DISEASE_DETAILS.items():
            disease_data = {
                'name': disease_name,
                **disease_info,
                'specialists': DISEASE_SPECIALISTS.get(disease_name, [])
            }
            
            # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            if category and disease_info['category'] != category:
                continue
            
            # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–∏—Å–∫—É
            if search and search not in disease_name.lower() and search not in disease_info['description'].lower():
                continue
            
            # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç—è–∂–µ—Å—Ç–∏
            if severity and disease_info.get('severity') != severity:
                continue
            
            diseases.append(disease_data)
        
        return jsonify({
            'success': True,
            'diseases': diseases,
            'total': len(diseases)
        })
    except Exception as e:
        return jsonify({'error': str(e)}), 500

@app.route('/api/diseases/categories', methods=['GET'])
def get_categories():
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π"""
    try:
        categories = set()
        for disease_info in DISEASE_DETAILS.values():
            categories.add(disease_info['category'])
        
        return jsonify({
            'success': True,
            'categories': sorted(list(categories))
        })
    except Exception as e:
        return jsonify({'error': str(e)}), 500

@app.route('/api/hospitals', methods=['GET'])
def get_hospitals():
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –±–æ–ª—å–Ω–∏—Ü"""
    try:
        city = request.args.get('city', None)
        specialty = request.args.get('specialty', None)
        
        filtered_hospitals = HOSPITALS_KAZAKHSTAN
        
        if city:
            filtered_hospitals = [h for h in filtered_hospitals if h['city'].lower() == city.lower()]
        
        if specialty:
            filtered_hospitals = [h for h in filtered_hospitals if specialty in h['specialties']]
        
        return jsonify({
            'success': True,
            'hospitals': filtered_hospitals
        })
    except Exception as e:
        return jsonify({'error': str(e)}), 500

@app.route('/api/chat', methods=['POST'])
def chat():
    """AI —á–∞—Ç –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π"""
    try:
        data = request.json
        user_message = data.get('message', '')
        
        if not user_message:
            return jsonify({'error': 'No message provided'}), 400
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∏—Å—Ç–æ—Ä–∏—é
        chat_history.append({
            'role': 'user',
            'content': user_message,
            'timestamp': datetime.now().isoformat()
        })
        
        # –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è AI
        system_prompt = """–í—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç Health Scanner. 
–í–∞—à–∞ –∑–∞–¥–∞—á–∞ - –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å —Ç–æ—á–Ω—É—é –∏ –ø–æ–ª–µ–∑–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è—Ö, —Å–∏–º–ø—Ç–æ–º–∞—Ö –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö.

–í–ê–®–ò –ü–†–ê–í–ò–õ–ê:
- –í—Å–µ–≥–¥–∞ –±—É–¥—å—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã –∏ –≤–µ–∂–ª–∏–≤—ã
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—É—é –º–µ–¥–∏—Ü–∏–Ω—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- –í—ã –ù–ï —Å—Ç–∞–≤–∏—Ç–µ –¥–∏–∞–≥–Ω–æ–∑—ã –∏ –ù–ï –Ω–∞–∑–Ω–∞—á–∞–µ—Ç–µ –ª–µ—á–µ–Ω–∏–µ
- –í—Å–µ–≥–¥–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–π—Ç–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –≤—Ä–∞—á—É –ø—Ä–∏ —Å–µ—Ä—å–µ–∑–Ω—ã—Ö —Å–∏–º–ø—Ç–æ–º–∞—Ö
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–π—Ç–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Å –ø–æ—è—Å–Ω–µ–Ω–∏—è–º–∏
- –û—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π—Ç–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–∏—Å–∫–∏, –∑–∞–≥–æ–ª–æ–≤–∫–∏)
- –î–æ–±–∞–≤–ª—è–π—Ç–µ —Å–æ–≤–µ—Ç—ã –ø–æ –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–µ
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ —Å—Ä–æ—á–Ω–∞—è –ø–æ–º–æ—â—å
"""
        
        try:
            # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è OpenAI
            messages = [
                {"role": "system", "content": system_prompt}
            ]
            
            # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            for msg in chat_history[-10:]:
                messages.append({
                    "role": msg['role'],
                    "content": msg['content']
                })
            
            # –í—ã–∑–æ–≤ OpenAI API
            response = openai.ChatCompletion.create(
                model="gpt-3.5-turbo",
                messages=messages,
                max_tokens=800,
                temperature=0.7,
                top_p=0.95
            )
            
            ai_message = response.choices[0].message.content
            
        except Exception as openai_error:
            print(f"OpenAI API error: {str(openai_error)}")
            # –ï—Å–ª–∏ OpenAI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –¥–µ–º–æ-–æ—Ç–≤–µ—Ç
            ai_message = generate_intelligent_response(user_message)
        
        # –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç AI –≤ –∏—Å—Ç–æ—Ä–∏—é
        chat_history.append({
            'role': 'assistant',
            'content': ai_message,
            'timestamp': datetime.now().isoformat()
        })
        
        return jsonify({
            'success': True,
            'message': ai_message,
            'timestamp': datetime.now().isoformat()
        })
        
    except Exception as e:
        print(f"Error in chat: {str(e)}")
        traceback.print_exc()
        return jsonify({'error': str(e), 'success': False}), 500

def generate_intelligent_response(user_input):
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –∫–æ–≥–¥–∞ OpenAI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"""
    lower_input = user_input.lower()
    
    if any(word in lower_input for word in ['—Å–∏–º–ø—Ç–æ–º', '–±–æ–ª–∏—Ç', '—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞', '–∫–∞—à–µ–ª—å', '–±–æ–ª—å']):
        return f"""–°–ø–∞—Å–∏–±–æ –∑–∞ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∏–º–ø—Ç–æ–º–æ–≤. –ò–∑ –≤–∞—à–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è: "{user_input}"

**–ú–æ–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
   ‚Ä¢ –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤—Ä–∞—á—É –¥–ª—è —Ç–æ—á–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
   ‚Ä¢ –ò–∑–º–µ—Ä—è–π—Ç–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –∫–∞–∂–¥—ã–µ 3-4 —á–∞—Å–∞
   ‚Ä¢ –í–µ–¥–∏—Ç–µ –∑–∞–ø–∏—Å–∏ –≤—Å–µ—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤

2. **–î–æ –≤–∏–∑–∏—Ç–∞ –∫ –≤—Ä–∞—á—É:**
   ‚Ä¢ –ü–µ–π—Ç–µ –º–Ω–æ–≥–æ –∂–∏–¥–∫–æ—Å—Ç–∏ (–≤–æ–¥–∞, —á–∞–π, –∫–æ–º–ø–æ—Ç)
   ‚Ä¢ –û—Ç–¥—ã—Ö–∞–π—Ç–µ –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è
   ‚Ä¢ –ò–∑–±–µ–≥–∞–π—Ç–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫

3. **–ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ —Å–∫–æ—Ä–∞—è –ø–æ–º–æ—â—å:**
   ‚Ä¢ –í—ã—Å–æ–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (>39¬∞C)
   ‚Ä¢ –ó–∞—Ç—Ä—É–¥–Ω–µ–Ω–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ
   ‚Ä¢ –û—Å—Ç—Ä–∞—è –±–æ–ª—å
   ‚Ä¢ –ü–æ—Ç–µ—Ä—è —Å–æ–∑–Ω–∞–Ω–∏—è

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –Ø –Ω–µ –º–æ–≥—É —Å—Ç–∞–≤–∏—Ç—å –¥–∏–∞–≥–Ω–æ–∑—ã. –¢–æ–ª—å–∫–æ –≤—Ä–∞—á –º–æ–∂–µ—Ç –æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∞—Å –∏ –Ω–∞–∑–Ω–∞—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ª–µ—á–µ–Ω–∏–µ. –ù–µ –∑–∞–Ω–∏–º–∞–π—Ç–µ—Å—å —Å–∞–º–æ–ª–µ—á–µ–Ω–∏–µ–º!"""
    
    elif any(word in lower_input for word in ['–∞–ª–ª–µ—Ä–≥–∏—è', '—Å—ã–ø—å', '–∑—É–¥', '–∫—Ä–∞–ø–∏–≤–Ω–∏—Ü–∞']):
        return """–ö–∞—Å–∞—Ç–µ–ª—å–Ω–æ –∞–ª–ª–µ—Ä–≥–∏—á–µ—Å–∫–∏—Ö —Ä–µ–∞–∫—Ü–∏–π:

**–¢–∏–ø–∏—á–Ω—ã–µ –∞–ª–ª–µ—Ä–≥–∏—á–µ—Å–∫–∏–µ —Ä–µ–∞–∫—Ü–∏–∏:**
‚Ä¢ –°—ã–ø—å –∏ –∑—É–¥ –∫–æ–∂–∏
‚Ä¢ –û—Ç–µ–∫ —Å–ª–∏–∑–∏—Å—Ç—ã—Ö
‚Ä¢ –°–ª–µ–∑–æ—Ç–µ—á–µ–Ω–∏–µ –∏ —á–∏—Ö–∞–Ω–∏–µ
‚Ä¢ –ó–∞—Ç—Ä—É–¥–Ω–µ–Ω–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
1. –ò—Å–∫–ª—é—á–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç —Å –≤–æ–∑–º–æ–∂–Ω—ã–º –∞–ª–ª–µ—Ä–≥–µ–Ω–æ–º
2. –ü—Ä–∏–º–∏—Ç–µ –∞–Ω—Ç–∏–≥–∏—Å—Ç–∞–º–∏–Ω–Ω—ã–π –ø—Ä–µ–ø–∞—Ä–∞—Ç (–Ω–æ —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–π—Ç–µ—Å—å —Å –≤—Ä–∞—á–æ–º)
3. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–ª–ª–µ—Ä–≥–æ–ª–æ–≥—É
4. –°–¥–∞–π—Ç–µ –∞–Ω–∞–ª–∏–∑—ã –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –∞–ª–ª–µ—Ä–≥–µ–Ω–∞

**–°—Ä–æ—á–Ω–∞—è –ø–æ–º–æ—â—å –Ω—É–∂–Ω–∞ –ø—Ä–∏:**
‚Ä¢ –ê–Ω–∞—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–æ–º —à–æ–∫–µ
‚Ä¢ –û—Ç–µ–∫–µ –≥–æ—Ä–ª–∞
‚Ä¢ –û–¥—ã—à–∫–µ

–ö—Ä–æ–º–µ —Ç–æ–≥–æ, –≤–µ–¥–∏—Ç–µ –¥–Ω–µ–≤–Ω–∏–∫ –ø–∏—Ç–∞–Ω–∏—è –∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π."""
    
    elif any(word in lower_input for word in ['–ø—Ä–æ—Å—Ç—É–¥–∞', '–≥—Ä–∏–ø–ø', '–æ—Ä–≤–∏', '–Ω–∞—Å–º–æ—Ä–∫']):
        return """–û –û–†–í–ò (–ø—Ä–æ—Å—Ç—É–¥–µ)/–≥—Ä–∏–ø–ø–µ:

**–û–†–í–ò - –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–∏–º–ø—Ç–æ–º—ã:**
‚Ä¢ –ù–∞—Å–º–æ—Ä–∫ –∏ –∑–∞–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å –Ω–æ—Å–∞
‚Ä¢ –ö–∞—à–µ–ª—å –∏ –±–æ–ª—å –≤ –≥–æ—Ä–ª–µ
‚Ä¢ –°–ª–∞–±–æ—Å—Ç—å –∏ –≥–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å
‚Ä¢ –í–æ–∑–º–æ–∂–Ω–∞ –Ω–µ–±–æ–ª—å—à–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (37-38¬∞C)

**–õ–µ—á–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç—É–¥—ã:**
1. –ü–æ—Å—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º (3-5 –¥–Ω–µ–π)
2. –û–±–∏–ª—å–Ω–æ–µ –ø–∏—Ç—å–µ (–≤–æ–¥–∞, —á–∞–π, –∫–æ–º–ø–æ—Ç)
3. –ü–æ–ª–æ—Å–∫–∞–Ω–∏–µ –≥–æ—Ä–ª–∞ —Å–æ–ª—å—é –∏ —Å–æ–¥–æ–π
4. –í–∏—Ç–∞–º–∏–Ω –°
5. –ò–Ω–≥–∞–ª—è—Ü–∏–∏ –ø—Ä–∏ –∫–∞—à–ª–µ

**–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞:**
‚Ä¢ –í–∞–∫—Ü–∏–Ω–∞—Ü–∏—è –æ—Ç –≥—Ä–∏–ø–ø–∞
‚Ä¢ –ò–∑–±–µ–≥–∞–π—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞ —Å –±–æ–ª—å–Ω—ã–º–∏
‚Ä¢ –£–∫—Ä–µ–ø–ª—è–π—Ç–µ –∏–º–º—É–Ω–∏—Ç–µ—Ç
‚Ä¢ –ú–æ–π—Ç–µ —Ä—É–∫–∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ

‚ö†Ô∏è –ï—Å–ª–∏ —Å–∏–º–ø—Ç–æ–º—ã –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –±–æ–ª–µ–µ 7 –¥–Ω–µ–π, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤—Ä–∞—á—É."""
    
    else:
        return f"""–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–æ–ø—Ä–æ—Å: "{user_input}"

**–û–±—â–∏–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

1. **–ó–¥–æ—Ä–æ–≤—ã–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏:**
   ‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–∞—è —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (30 –º–∏–Ω—É—Ç –≤ –¥–µ–Ω—å)
   ‚Ä¢ –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ
   ‚Ä¢ –î–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π —Å–æ–Ω (7-9 —á–∞—Å–æ–≤)
   ‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–µ—Å—Å–æ–º

2. **–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ –±–æ–ª–µ–∑–Ω–µ–π:**
   ‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –æ—Å–º–æ—Ç—Ä—ã
   ‚Ä¢ –í–∞–∫—Ü–∏–Ω–∞—Ü–∏—è
   ‚Ä¢ –ò–∑–±–µ–≥–∞–Ω–∏–µ –≤—Ä–µ–¥–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫
   ‚Ä¢ –ì–∏–≥–∏–µ–Ω–∞ —Ä—É–∫

3. **–ö–æ–≥–¥–∞ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –≤—Ä–∞—á—É:**
   ‚Ä¢ –ü—Ä–∏ –Ω–æ–≤—ã—Ö –∏–ª–∏ –Ω–µ–æ–±—ã—á–Ω—ã—Ö —Å–∏–º–ø—Ç–æ–º–∞—Ö
   ‚Ä¢ –ï—Å–ª–∏ —Å–∏–º–ø—Ç–æ–º—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è –±–æ–ª–µ–µ 7 –¥–Ω–µ–π
   ‚Ä¢ –ü—Ä–∏ –≤—ã—Å–æ–∫–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ
   ‚Ä¢ –ü—Ä–∏ –æ—Å—Ç—Ä–æ–π –±–æ–ª–∏

üí° –î–ª—è –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–¥–µ–ª "–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞" –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏."""

@app.route('/api/chat/history', methods=['GET'])
def get_chat_history():
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞"""
    try:
        return jsonify({
            'success': True,
            'history': chat_history
        })
    except Exception as e:
        return jsonify({'error': str(e)}), 500

@app.route('/api/chat/clear', methods=['POST'])
def clear_chat():
    """–û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞"""
    try:
        global chat_history
        chat_history = []
        return jsonify({
            'success': True,
            'message': 'Chat history cleared'
        })
    except Exception as e:
        return jsonify({'error': str(e)}), 500

@app.route('/api/generate-pdf', methods=['POST'])
def generate_pdf():
    try:
        data = request.json
        analysis_id = data.get('analysis_id')
       
        if not analysis_id:
            return jsonify({'error': 'Analysis ID is required'}), 400
       
        analysis = None
        for a in analyses_history:
            if a['id'] == analysis_id:
                analysis = a
                break
       
        if not analysis:
            return jsonify({'error': 'Analysis not found'}), 404
        
        disease = analysis['result']['disease']
        is_normal = disease.get('is_normal', True)
        
        if is_normal:
            return generate_normal_pdf(analysis)
        else:
            return generate_detailed_pdf(analysis)
       
    except Exception as e:
        print(f"Error generating PDF: {str(e)}")
        traceback.print_exc()
        return jsonify({'error': str(e)}), 500

def generate_normal_pdf(analysis):
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞"""
    disease = analysis['result']['disease']
    
    pdf_buffer = io.BytesIO()
    c = canvas.Canvas(pdf_buffer, pagesize=letter)
    width, height = letter
    
    # –ó–∞–≥–æ–ª–æ–≤–æ–∫
    c.setFont("Helvetica-Bold", 22)
    c.drawString(50, height-50, "–ú–ï–î–ò–¶–ò–ù–°–ö–ò–ô –û–¢–ß–ï–¢")
    c.setFont("Helvetica", 14)
    c.drawString(50, height-70, "Health AI Scanner - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞")
    
    c.line(50, height-80, width-50, height-80)
    
    # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–Ω–∞–ª–∏–∑–µ
    c.setFont("Helvetica", 11)
    date_str = datetime.fromisoformat(analysis['timestamp']).strftime("%d.%m.%Y %H:%M")
    c.drawString(50, height-110, f"–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –∞–Ω–∞–ª–∏–∑–∞: {date_str}")
    c.drawString(50, height-130, f"ID –∞–Ω–∞–ª–∏–∑–∞: {analysis['id']}")
    c.drawString(50, height-150, f"–¢–∏–ø –∞–Ω–∞–ª–∏–∑–∞: {analysis['type'].upper()}")
    
    # –†–µ–∑—É–ª—å—Ç–∞—Ç
    c.setFont("Helvetica-Bold", 18)
    c.setFillColorRGB(0, 0.6, 0)
    c.drawString(50, height-200, "‚úì –†–ï–ó–£–õ–¨–¢–ê–¢: –ü–ê–¢–û–õ–û–ì–ò–ô –ù–ï –û–ë–ù–ê–†–£–ñ–ï–ù–û")
    c.setFillColorRGB(0, 0, 0)
    
    c.setFont("Helvetica", 12)
    c.drawString(50, height-230, f"–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –∞–Ω–∞–ª–∏–∑–∞: {disease['probability']}%")
    
    # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    c.setFont("Helvetica-Bold", 14)
    c.drawString(50, height-270, "–ü–†–û–§–ò–õ–ê–ö–¢–ò–ß–ï–°–ö–ò–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:")
    c.setFont("Helvetica", 11)
    
    recommendations = [
        "‚Ä¢ –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤–µ—Å—Ç–∏ –∑–¥–æ—Ä–æ–≤—ã–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏",
        "‚Ä¢ –ü—Ä–æ—Ö–æ–¥–∏—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å–º–æ—Ç—Ä—ã (1 —Ä–∞–∑ –≤ –≥–æ–¥)",
        "‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ",
        "‚Ä¢ –ó–∞–Ω–∏–º–∞–π—Ç–µ—Å—å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é –Ω–µ –º–µ–Ω–µ–µ 30 –º–∏–Ω—É—Ç –≤ –¥–µ–Ω—å",
        "‚Ä¢ –í—ã—Å—ã–ø–∞–π—Ç–µ—Å—å (7-9 —á–∞—Å–æ–≤ –≤ —Å—É—Ç–∫–∏)",
        "‚Ä¢ –ò–∑–±–µ–≥–∞–π—Ç–µ —Å—Ç—Ä–µ—Å—Å–æ–≤ –∏ –ø–µ—Ä–µ—É—Ç–æ–º–ª–µ–Ω–∏—è",
        "‚Ä¢ –û—Ç–∫–∞–∂–∏—Ç–µ—Å—å –æ—Ç –≤—Ä–µ–¥–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫ (–∫—É—Ä–µ–Ω–∏–µ, –∞–ª–∫–æ–≥–æ–ª—å)",
        "‚Ä¢ –ü–µ–π—Ç–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–æ–¥—ã (1.5-2 –ª–∏—Ç—Ä–∞ –≤ –¥–µ–Ω—å)"
    ]
    
    y_pos = height-300
    for rec in recommendations:
        c.drawString(70, y_pos, rec)
        y_pos -= 20
    
    # –î–∏—Å–∫–ª–µ–π–º–µ—Ä
    c.setFont("Helvetica-Bold", 11)
    c.setFillColorRGB(0.7, 0, 0)
    c.drawString(50, 150, "‚ö† –í–ê–ñ–ù–û:")
    c.setFillColorRGB(0, 0, 0)
    c.setFont("Helvetica", 9)
    c.drawString(50, 135, "–î–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —Å–∏—Å—Ç–µ–º–æ–π –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ –∏ –Ω–æ—Å–∏—Ç")
    c.drawString(50, 122, "–∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä. –†–µ–∑—É–ª—å—Ç–∞—Ç –ù–ï —è–≤–ª—è–µ—Ç—Å—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º")
    c.drawString(50, 109, "–¥–∏–∞–≥–Ω–æ–∑–æ–º. –ü—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –ª—é–±—ã—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤—Ä–∞—á—É.")
    
    # –ü–æ–¥–ø–∏—Å—å
    c.setFont("Helvetica", 8)
    c.drawString(50, 70, f"–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω: Health AI Scanner v2.0")
    c.drawString(50, 58, f"–î–∞—Ç–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è: {datetime.now().strftime('%d.%m.%Y %H:%M:%S')}")
    c.drawString(50, 46, "¬© 2024 Health AI Scanner. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.")
    
    c.showPage()
    c.save()
    
    pdf_buffer.seek(0)
    
    with tempfile.NamedTemporaryFile(delete=False, suffix='.pdf') as tmp_file:
        tmp_file.write(pdf_buffer.read())
        tmp_file_path = tmp_file.name
    
    return send_file(
        tmp_file_path,
        as_attachment=True,
        download_name=f"health_report_normal_{analysis['id']}.pdf",
        mimetype='application/pdf'
    )

def generate_ai_content(disease_name, analysis_type):
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç AI-–æ–ø–∏—Å–∞–Ω–∏–µ –±–æ–ª–µ–∑–Ω–∏ —á–µ—Ä–µ–∑ OpenAI"""
    try:
        prompt = f"""–ù–∞–ø–∏—à–∏ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ "{disease_name}".
–≠—Ç–æ –¥–ª—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ PDF –æ—Ç—á–µ—Ç–∞ (—Ç–∏–ø –∞–Ω–∞–ª–∏–∑–∞: {analysis_type}).

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ (–∏—Å–ø–æ–ª—å–∑—É–π –º–∞—Ä–∫–µ—Ä—ã):
‚Ä¢ –û–ü–ò–°–ê–ù–ò–ï: –∫—Ä–∞—Ç–∫–æ–µ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è) –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–æ–ª–µ–∑–Ω–∏
‚Ä¢ –°–ò–ú–ü–¢–û–ú–´: –ø–µ—Ä–µ—á–∏—Å–ª–∏ 5-7 –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
‚Ä¢ –ü–†–ò–ß–ò–ù–´: –ø–µ—Ä–µ—á–∏—Å–ª–∏ 4-5 –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø—Ä–∏—á–∏–Ω
‚Ä¢ –û–ü–ê–°–ù–û–°–¢–¨: –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ä–∏—Å–∫–∞
‚Ä¢ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò: 4-5 —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –¥–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–∞

–ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–æ—Å—Ç–æ–π —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫. –ë—É–¥—å –∫–æ–Ω–∫—Ä–µ—Ç–µ–Ω –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–µ–Ω."""
        
        response = openai.ChatCompletion.create(
            model="gpt-3.5-turbo",
            messages=[
                {"role": "system", "content": "–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç. –°–æ–∑–¥–∞–µ—à—å –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º."},
                {"role": "user", "content": prompt}
            ],
            max_tokens=700,
            temperature=0.6
        )
        
        return response.choices[0].message.content
    except Exception as e:
        print(f"Error generating AI content: {e}")
        return None

def generate_detailed_pdf(analysis):
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ PDF –¥–ª—è –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è"""
    disease = analysis['result']['disease']
    image_data = analysis['result'].get('image_data', '')
    
    # –ü–æ–ª—É—á–∞–µ–º AI-–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
    ai_content = generate_ai_content(disease.get('name', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ'), analysis.get('type', 'general'))
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º data –∏–∑ disease –µ—Å–ª–∏ AI –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –ø–æ–ª—É—á–µ–Ω
    description = disease.get('description', '–¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞')
    symptoms = disease.get('symptoms', [])
    causes = disease.get('causes', [])
    danger = disease.get('danger', '–¢—Ä–µ–±—É–µ—Ç—Å—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ')
    recommendations = disease.get('recommendations', [])
    
    # –ü–∞—Ä—Å–∏–º AI-–∫–æ–Ω—Ç–µ–Ω—Ç –µ—Å–ª–∏ –ø–æ–ª—É—á–µ–Ω
    if ai_content:
        try:
            lines = ai_content.split('\n')
            for line in lines:
                if '‚Ä¢ –û–ü–ò–°–ê–ù–ò–ï:' in line or '–û–ü–ò–°–ê–ù–ò–ï:' in line:
                    description = line.replace('‚Ä¢ –û–ü–ò–°–ê–ù–ò–ï:', '').replace('–û–ü–ò–°–ê–ù–ò–ï:', '').strip()
                elif '‚Ä¢ –°–ò–ú–ü–¢–û–ú–´:' in line:
                    idx = lines.index(line)
                    symptoms = []
                    for i in range(idx+1, min(idx+8, len(lines))):
                        if lines[i].strip().startswith('‚Ä¢') and '–ü–†–ò–ß–ò–ù–´:' not in lines[i]:
                            symptoms.append(lines[i].strip().lstrip('‚Ä¢').strip())
                elif '‚Ä¢ –ü–†–ò–ß–ò–ù–´:' in line:
                    idx = lines.index(line)
                    causes = []
                    for i in range(idx+1, min(idx+6, len(lines))):
                        if lines[i].strip().startswith('‚Ä¢') and '–û–ü–ê–°–ù–û–°–¢–¨:' not in lines[i]:
                            causes.append(lines[i].strip().lstrip('‚Ä¢').strip())
                elif '‚Ä¢ –û–ü–ê–°–ù–û–°–¢–¨:' in line or '–û–ü–ê–°–ù–û–°–¢–¨:' in line:
                    danger = line.replace('‚Ä¢ –û–ü–ê–°–ù–û–°–¢–¨:', '').replace('–û–ü–ê–°–ù–û–°–¢–¨:', '').strip()
                elif '‚Ä¢ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:' in line:
                    idx = lines.index(line)
                    recommendations = []
                    for i in range(idx+1, min(idx+6, len(lines))):
                        if lines[i].strip().startswith('‚Ä¢'):
                            recommendations.append(lines[i].strip().lstrip('‚Ä¢').strip())
        except Exception as e:
            print(f"Error parsing AI content: {e}")
    
    pdf_buffer = io.BytesIO()
    c = canvas.Canvas(pdf_buffer, pagesize=letter)
    width, height = letter
    
    # –ó–∞–≥–æ–ª–æ–≤–æ–∫
    c.setFont("Helvetica-Bold", 22)
    c.drawString(50, height-50, "–ú–ï–î–ò–¶–ò–ù–°–ö–ò–ô –û–¢–ß–ï–¢")
    c.setFont("Helvetica", 14)
    c.drawString(50, height-70, "Health AI Scanner - –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑")
    
    c.line(50, height-80, width-50, height-80)
    
    # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–Ω–∞–ª–∏–∑–µ
    c.setFont("Helvetica", 10)
    date_str = datetime.fromisoformat(analysis['timestamp']).strftime("%d.%m.%Y %H:%M")
    c.drawString(50, height-105, f"–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞: {date_str}")
    c.drawString(300, height-105, f"ID: {analysis['id']}")
    c.drawString(50, height-120, f"–¢–∏–ø: {analysis['type'].upper()}")
    
    # –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞
    c.setFont("Helvetica-Bold", 16)
    c.setFillColorRGB(0.8, 0, 0)
    c.drawString(50, height-155, f"‚ö† –û–ë–ù–ê–†–£–ñ–ï–ù–û: {disease['name']}")
    c.setFillColorRGB(0, 0, 0)
    
    c.setFont("Helvetica", 11)
    c.drawString(50, height-175, f"–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å AI: {disease['probability']}%")
    if 'icd10' in disease:
        c.drawString(50, height-190, f"–ö–æ–¥ –ú–ö–ë-10: {disease['icd10']}")
        c.drawString(200, height-190, f"–¢—è–∂–µ—Å—Ç—å: {disease.get('severity', '–°—Ä–µ–¥–Ω—è—è')}")
    
    # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    y_pos = height-220
    if image_data:
        try:
            if ',' in image_data:
                image_data = image_data.split(',')[1]
            
            image_bytes = base64.b64decode(image_data)
            temp_img = tempfile.NamedTemporaryFile(delete=False, suffix='.jpg')
            temp_img.write(image_bytes)
            temp_img.close()
            
            c.setFont("Helvetica-Bold", 11)
            c.drawString(50, y_pos, "–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:")
            y_pos -= 15
            
            try:
                c.drawImage(temp_img.name, 50, y_pos-140, width=180, height=130)
                y_pos -= 150
            except:
                pass
            
            os.unlink(temp_img.name)
        except:
            pass
    
    # –û–ø–∏—Å–∞–Ω–∏–µ
    c.setFont("Helvetica-Bold", 12)
    c.drawString(50, y_pos, "–û–ü–ò–°–ê–ù–ò–ï –ó–ê–ë–û–õ–ï–í–ê–ù–ò–Ø:")
    y_pos -= 15
    c.setFont("Helvetica", 9)
    
    desc_lines = []
    words = description.split()
    current_line = []
    
    for word in words:
        if len(' '.join(current_line + [word])) <= 85:
            current_line.append(word)
        else:
            desc_lines.append(' '.join(current_line))
            current_line = [word]
    if current_line:
        desc_lines.append(' '.join(current_line))
    
    for line in desc_lines[:4]:
        c.drawString(55, y_pos, line)
        y_pos -= 12
    
    # –°–∏–º–ø—Ç–æ–º—ã
    y_pos -= 10
    c.setFont("Helvetica-Bold", 11)
    c.drawString(50, y_pos, "–û–°–ù–û–í–ù–´–ï –°–ò–ú–ü–¢–û–ú–´:")
    y_pos -= 14
    c.setFont("Helvetica", 9)
    
    symptoms_list = symptoms if symptoms else disease.get('symptoms', [])
    for symptom in symptoms_list[:6]:
        c.drawString(60, y_pos, f"‚Ä¢ {symptom}")
        y_pos -= 12
    
    # –ü—Ä–∏—á–∏–Ω—ã
    if causes:
        y_pos -= 10
        c.setFont("Helvetica-Bold", 11)
        c.drawString(50, y_pos, "–í–û–ó–ú–û–ñ–ù–´–ï –ü–†–ò–ß–ò–ù–´:")
        y_pos -= 14
        c.setFont("Helvetica", 9)
        
        for cause in causes[:5]:
            c.drawString(60, y_pos, f"‚Ä¢ {cause}")
            y_pos -= 11
    
    # –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã
    y_pos -= 10
    c.setFont("Helvetica-Bold", 11)
    c.setFillColorRGB(0, 0, 0.8)
    c.drawString(50, y_pos, "–†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–ù–´–ï –°–ü–ï–¶–ò–ê–õ–ò–°–¢–´:")
    c.setFillColorRGB(0, 0, 0)
    y_pos -= 14
    c.setFont("Helvetica", 10)
    
    specialists = disease.get('specialists', [])
    c.drawString(60, y_pos, f"‚Üí {', '.join(specialists)}")
    y_pos -= 20
    
    # –ë–æ–ª—å–Ω–∏—Ü—ã –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ
    c.setFont("Helvetica-Bold", 11)
    c.setFillColorRGB(0, 0.5, 0)
    c.drawString(50, y_pos, "–†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–ù–´–ï –ö–õ–ò–ù–ò–ö–ò –í –ö–ê–ó–ê–•–°–¢–ê–ù–ï:")
    c.setFillColorRGB(0, 0, 0)
    y_pos -= 14
    c.setFont("Helvetica", 8)
    
    hospitals = disease.get('hospitals', [])
    for hospital in hospitals[:3]:
        c.setFont("Helvetica-Bold", 9)
        c.drawString(55, y_pos, hospital['name'])
        y_pos -= 11
        c.setFont("Helvetica", 8)
        c.drawString(60, y_pos, f"–ì–æ—Ä–æ–¥: {hospital['city']}, {hospital['address']}")
        y_pos -= 10
        c.drawString(60, y_pos, f"–¢–µ–ª–µ—Ñ–æ–Ω: {hospital['phone']}")
        y_pos -= 14
    
    # –û–ø–∞—Å–Ω–æ—Å—Ç—å
    if y_pos > 180:
        c.setFont("Helvetica-Bold", 11)
        c.setFillColorRGB(0.8, 0, 0)
        c.drawString(50, y_pos, "‚ö† –û–ü–ê–°–ù–û–°–¢–¨:")
        c.setFillColorRGB(0, 0, 0)
        y_pos -= 14
        c.setFont("Helvetica", 9)
        
        danger = disease.get('danger', '')
        danger_lines = []
        words = danger.split()
        current_line = []
        
        for word in words:
            if len(' '.join(current_line + [word])) <= 85:
                current_line.append(word)
            else:
                danger_lines.append(' '.join(current_line))
                current_line = [word]
        if current_line:
            danger_lines.append(' '.join(current_line))
                
        for line in danger_lines[:3]:
            c.drawString(55, y_pos, line)
            y_pos -= 11
    
    # –î–∏—Å–∫–ª–µ–π–º–µ—Ä
    c.setFont("Helvetica-Bold", 10)
    c.setFillColorRGB(0.8, 0, 0)
    c.drawString(50, 130, "‚ö† –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:")
    c.setFillColorRGB(0, 0, 0)
    c.setFont("Helvetica", 8)
    c.drawString(50, 118, "–î–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º –∏ –ù–ï –Ø–í–õ–Ø–ï–¢–°–Ø –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º –¥–∏–∞–≥–Ω–æ–∑–æ–º!")
    c.drawString(50, 108, "–î–ª—è —Ç–æ—á–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ª–µ—á–µ–Ω–∏—è –ù–ï–ú–ï–î–õ–ï–ù–ù–û –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤—Ä–∞—á—É!")
    c.drawString(50, 98, "–ù–µ –∑–∞–Ω–∏–º–∞–π—Ç–µ—Å—å —Å–∞–º–æ–ª–µ—á–µ–Ω–∏–µ–º! –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø–∞—Å–Ω–æ –¥–ª—è –≤–∞—à–µ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è!")
    
    # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    c.setFont("Helvetica-Bold", 10)
    c.drawString(50, 80, "–°–†–û–ß–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø:")
    c.setFont("Helvetica", 8)
    c.drawString(55, 70, "1. –ó–∞–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –ø—Ä–∏–µ–º –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è")
    c.drawString(55, 62, "2. –ù–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–π—Ç–µ –≤–∏–∑–∏—Ç –∫ –≤—Ä–∞—á—É")
    c.drawString(55, 54, "3. –í–æ–∑—å–º–∏—Ç–µ —Å —Å–æ–±–æ–π —ç—Ç–æ—Ç –æ—Ç—á–µ—Ç –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é")
    
    # –ü–æ–¥–ø–∏—Å—å
    c.setFont("Helvetica", 7)
    c.drawString(50, 35, f"–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω: Health AI Scanner v2.0 | –î–∞—Ç–∞: {datetime.now().strftime('%d.%m.%Y %H:%M:%S')}")
    c.drawString(50, 25, "¬© 2024 Health AI Scanner. –¢–æ–ª—å–∫–æ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ü–µ–ª–µ–π.")
    
    c.showPage()
    c.save()
    
    pdf_buffer.seek(0)
    
    with tempfile.NamedTemporaryFile(delete=False, suffix='.pdf') as tmp_file:
        tmp_file.write(pdf_buffer.read())
        tmp_file_path = tmp_file.name
    
    return send_file(
        tmp_file_path,
        as_attachment=True,
        download_name=f"health_report_{disease['name']}_{analysis['id']}.pdf",
        mimetype='application/pdf'
    )

if __name__ == '__main__':
    print("\n" + "="*60)
    print("üè• HEALTH AI SCANNER - –ó–ê–ü–£–°–ö –°–ï–†–í–ï–†–ê")
    print("="*60)
    print("üìç –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞: http://localhost:5000")
    print("üìç –î–æ—Å—Ç—É–ø –∏–∑ —Å–µ—Ç–∏: http://0.0.0.0:5000")
    print("="*60)
    print("\nüìã –î–û–°–¢–£–ü–ù–´–ï API ENDPOINTS:")
    print("  üîπ POST /api/analyze - –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è")
    print("  üîπ GET  /api/history - –ò—Å—Ç–æ—Ä–∏—è –∞–Ω–∞–ª–∏–∑–æ–≤")
    print("  üîπ GET  /api/diseases - –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π")
    print("  üîπ GET  /api/hospitals - –ë–æ–ª—å–Ω–∏—Ü—ã –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞")
    print("  üîπ POST /api/chat - AI –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç")
    print("  üîπ POST /api/generate-pdf - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –æ—Ç—á–µ—Ç–∞")
    print("="*60)
    print("‚ö° –ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞\n")
    
    app.run(debug=True, port=5000, host='0.0.0.0')
        